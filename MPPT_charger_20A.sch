EESchema Schematic File Version 4
LIBS:MPPT_charger_20A-cache
EELAYER 26 0
EELAYER END
$Descr A4 11693 8268
encoding utf-8
Sheet 1 6
Title "MPPT Charger 20A"
Date "2018-01-18"
Rev "0.10"
Comp "Libre Solar"
Comment1 "Author: Martin JÃ¤ger"
Comment2 "Website: http://libre.solar"
Comment3 ""
Comment4 ""
$EndDescr
$Sheet
S 6300 2100 1400 1000
U 58A68DC9
F0 "DCDC power stage" 50
F1 "dcdc.sch" 50
F2 "PWM_HS" I L 6300 2200 50 
F3 "PWM_LS" I L 6300 2300 50 
F4 "BAT-" I R 7700 2800 50 
F5 "DCDC_OUT" O R 7700 2500 50 
F6 "DCDC_IN" O R 7700 2400 50 
F7 "DCDC-" O R 7700 2700 50 
F8 "~LOAD_EN" I L 6300 2500 50 
F9 "LOAD-SW" O R 7700 2900 50 
$EndSheet
$Sheet
S 4100 2100 1200 2400
U 58A68DCB
F0 "MCU" 50
F1 "mcu.sch" 50
F2 "TIM1_CH1N" O R 5300 2300 50 
F3 "TIM1_CH1" O R 5300 2200 50 
F4 "V_BAT" I R 5300 3000 50 
F5 "V_SOLAR" I R 5300 2900 50 
F6 "I_LOAD" I R 5300 3300 50 
F7 "I_DCDC" I R 5300 3200 50 
F8 "CAN_TX" O L 4100 3300 50 
F9 "CAN_RX" I L 4100 3400 50 
F10 "I2C1_SDA" I L 4100 2600 50 
F11 "I2C1_SCL" I L 4100 2500 50 
F12 "SPI1_MOSI" I L 4100 2900 50 
F13 "SPI1_MISO" I L 4100 2800 50 
F14 "SPI1_SCK" O L 4100 3000 50 
F15 "SSEL" I L 4100 3100 50 
F16 "USB_DM" I L 4100 3800 50 
F17 "USB_DP" I L 4100 3700 50 
F18 "CAN_STB" I L 4100 3500 50 
F19 "USART2_RX" I L 4100 2300 50 
F20 "USART2_TX" I L 4100 2200 50 
F21 "TEMP_INT" I R 5300 4300 50 
F22 "TEMP_BAT" I R 5300 4200 50 
F23 "DAC" O R 5300 3400 50 
F24 "5V_OUT_EN" O L 4100 4200 50 
F25 "UEXT_EN" O L 4100 4000 50 
F26 "V_BUS_EN" O L 4100 4100 50 
F27 "~LOAD_EN" O R 5300 2500 50 
$EndSheet
$Sheet
S 8600 2100 1200 600 
U 58C18D5C
F0 "Power Supply" 50
F1 "power_supply.sch" 50
F2 "DCDC_IN" I L 8600 2400 50 
$EndSheet
Wire Wire Line
	5300 2200 6300 2200
Wire Wire Line
	6300 2300 5300 2300
$Sheet
S 1700 2100 1400 2600
U 58BE3089
F0 "Communication Interfaces" 50
F1 "interfaces.sch" 50
F2 "UEXT_RX" O R 3100 2300 50 
F3 "UEXT_MOSI" I R 3100 2900 50 
F4 "UEXT_SSEL" I R 3100 3100 50 
F5 "UEXT_MISO" O R 3100 2800 50 
F6 "UEXT_SCK" I R 3100 3000 50 
F7 "UEXT_SCL" I R 3100 2500 50 
F8 "UEXT_SDA" B R 3100 2600 50 
F9 "UEXT_TX" I R 3100 2200 50 
F10 "USB_DM" B R 3100 3800 50 
F11 "USB_DP" B R 3100 3700 50 
F12 "CAN_RX" O R 3100 3400 50 
F13 "CAN_TX" I R 3100 3300 50 
F14 "CAN_STB" I R 3100 3500 50 
F15 "5V_OUT" O R 3100 4300 50 
F16 "5V_OUT_EN" I R 3100 4200 50 
F17 "DCDC_OUT" I R 3100 4500 50 
F18 "UEXT_EN" I R 3100 4000 50 
F19 "V_BUS_EN" I R 3100 4100 50 
$EndSheet
Wire Wire Line
	3100 2200 4100 2200
Wire Wire Line
	4100 2300 3100 2300
Wire Wire Line
	3100 3000 4100 3000
Wire Wire Line
	4100 2900 3100 2900
Wire Wire Line
	3100 2800 4100 2800
Wire Wire Line
	4100 3300 3100 3300
Wire Wire Line
	3100 3400 4100 3400
Wire Wire Line
	3100 3700 4100 3700
Text Notes 2450 1400 0    200  ~ 0
Libre Solar MPPT Charge Controller (20A)
Text Notes 1500 6100 0    100  ~ 0
Main Specifications
Text Notes 1500 7000 0    50   ~ 0
- 12V or 24V battery voltage\n- 20A max. charge current\n- 55V max. solar input\n- External temperature sensor input\n- 32bit ARM MCU (STM32F072)\n- CAN communication interface RJ45 jacks incl. bus power supply\n- Expandable via Olimex Universal Extension Connector (UEXT) featuring\n   I2C, Serial and SPI interface (e.g. used for display, WIFI communication, etc.)\n- Prepared for Hammond Mfg. 1591XXCFL enclosure\n   (light pipe of 30.5 mm length should be used for SMD LEDs, e.g. Bivar PLP2-1200)\n
$Comp
L Graphic:Logo_Open_Hardware_Small LOGO2
U 1 1 58C36283
P 10550 6100
F 0 "LOGO2" H 10550 6375 50  0000 C CNN
F 1 "OPEN_HARDWARE" H 10550 5875 50  0000 C CNN
F 2 "Symbol:OSHW-Logo_5.7x6mm_SilkScreen" H 10550 6100 60  0001 C CNN
F 3 "" H 10550 6100 60  0001 C CNN
	1    10550 6100
	1    0    0    -1  
$EndComp
$Comp
L Project:LibreSolar_Logo LOGO1
U 1 1 58C39FC7
P 9650 6100
F 0 "LOGO1" H 9650 6375 50  0000 C CNN
F 1 "LIBRE_SOLAR" H 9650 5875 50  0000 C CNN
F 2 "LibreSolar:LIBRESOLAR_LOGO" H 9670 6090 60  0001 C CNN
F 3 "" H 9670 6090 60  0001 C CNN
	1    9650 6100
	1    0    0    -1  
$EndComp
Wire Wire Line
	7700 2400 8100 2400
$Sheet
S 6300 3400 1400 1500
U 58E22D17
F0 "Analog Frontend" 50
F1 "analog_frontend.sch" 50
F2 "V_BAT" O R 7700 4100 50 
F3 "V_SOLAR" O R 7700 4000 50 
F4 "TEMP_BAT" O L 6300 4200 50 
F5 "TEMP_INT" O L 6300 4300 50 
F6 "DCDC_SHUNT+" I R 7700 3700 50 
F7 "LOAD_SHUNT+" I R 7700 3500 50 
F8 "LOAD_SHUNT-" I R 7700 3600 50 
F9 "DCDC_SHUNT-" I R 7700 3800 50 
F10 "V_SOLAR_ADC" O L 6300 3500 50 
F11 "V_BAT_ADC" O L 6300 3600 50 
F12 "I_LOAD_ADC" O L 6300 3900 50 
F13 "I_DCDC_ADC" O L 6300 3800 50 
F14 "REF_DIFF_AMP" I L 6300 4000 50 
$EndSheet
Text Notes 2000 3400 0    100  ~ 0
UEXT\n\nCAN\n\nUSB
Wire Wire Line
	5300 2500 6300 2500
Text Notes 6550 2850 0    100  ~ 0
DC/DC
Text Notes 4800 3750 0    100  ~ 0
MCU
Text Notes 6900 4650 0    100  ~ 0
Analog
Text Notes 9200 2450 0    100  ~ 0
Power
Wire Wire Line
	5300 2900 6000 2900
Wire Wire Line
	6000 2900 6000 3500
Wire Wire Line
	6000 3500 6300 3500
Wire Wire Line
	6300 3600 5900 3600
Wire Wire Line
	5900 3600 5900 3000
Wire Wire Line
	5900 3000 5300 3000
Wire Wire Line
	5300 3200 5700 3200
Wire Wire Line
	5700 3200 5700 3800
Wire Wire Line
	5700 3800 6300 3800
Wire Wire Line
	6300 3900 5600 3900
Wire Wire Line
	5600 3900 5600 3300
Wire Wire Line
	5600 3300 5300 3300
Wire Wire Line
	5300 3400 5500 3400
Wire Wire Line
	5500 3400 5500 4000
Wire Wire Line
	5500 4000 6300 4000
Wire Wire Line
	5300 4200 5900 4200
Wire Wire Line
	5300 4300 6300 4300
Wire Wire Line
	3100 3800 4100 3800
Wire Wire Line
	3100 3100 4100 3100
Wire Wire Line
	4100 2600 3100 2600
Wire Wire Line
	3100 2500 4100 2500
Wire Wire Line
	3100 3500 4100 3500
Wire Wire Line
	7700 2800 7900 2800
Wire Wire Line
	7700 2900 7800 2900
Wire Wire Line
	7700 2700 8000 2700
Wire Wire Line
	7800 2900 7800 3500
Wire Wire Line
	7800 3500 7700 3500
Wire Wire Line
	7700 3600 7900 3600
Wire Wire Line
	7900 2800 7900 3600
Wire Wire Line
	7900 3700 7700 3700
Connection ~ 7900 3600
Wire Wire Line
	7700 3800 8000 3800
Wire Wire Line
	8000 3800 8000 2700
Wire Wire Line
	8100 2400 8100 4000
Wire Wire Line
	8100 4000 7700 4000
Connection ~ 8100 2400
Wire Wire Line
	8200 2500 8200 4100
Wire Wire Line
	8200 4100 7700 4100
$Comp
L Mechanical:MountingHole MK1
U 1 1 595388B0
P 6050 7050
F 0 "MK1" H 6150 7096 50  0000 L CNN
F 1 "Mounting_Hole" H 6150 7005 50  0000 L CNN
F 2 "MountingHole:MountingHole_3.2mm_M3" H 6050 7050 50  0001 C CNN
F 3 "" H 6050 7050 50  0001 C CNN
	1    6050 7050
	1    0    0    -1  
$EndComp
$Comp
L Mechanical:MountingHole MK2
U 1 1 59538A86
P 6050 7250
F 0 "MK2" H 6150 7296 50  0000 L CNN
F 1 "Mounting_Hole" H 6150 7205 50  0000 L CNN
F 2 "MountingHole:MountingHole_3.2mm_M3" H 6050 7250 50  0001 C CNN
F 3 "" H 6050 7250 50  0001 C CNN
	1    6050 7250
	1    0    0    -1  
$EndComp
$Comp
L Mechanical:MountingHole MK3
U 1 1 59538C18
P 6050 7450
F 0 "MK3" H 6150 7496 50  0000 L CNN
F 1 "Mounting_Hole" H 6150 7405 50  0000 L CNN
F 2 "MountingHole:MountingHole_3.2mm_M3" H 6050 7450 50  0001 C CNN
F 3 "" H 6050 7450 50  0001 C CNN
	1    6050 7450
	1    0    0    -1  
$EndComp
$Comp
L Connector_Generic:Conn_01x03 J5
U 1 1 59553D8B
P 4700 4900
F 0 "J5" H 4778 4941 50  0000 L CNN
F 1 "CONN_01X03" H 4778 4850 50  0000 L CNN
F 2 "LibreSolar:Phoenix_Contact_MC_1,5_3-G-3,81" H 4700 4900 50  0001 C CNN
F 3 "" H 4700 4900 50  0001 C CNN
F 4 "Phoenix Contact" H 1900 -300 60  0001 C CNN "Manufacturer"
F 5 "1803280" H 1900 -300 60  0001 C CNN "PartNumber"
	1    4700 4900
	-1   0    0    -1  
$EndComp
$Comp
L power:GND #PWR01
U 1 1 59553D94
P 5200 5000
F 0 "#PWR01" H 5200 4750 50  0001 C CNN
F 1 "GND" H 5205 4827 50  0000 C CNN
F 2 "" H 5200 5000 50  0001 C CNN
F 3 "" H 5200 5000 50  0001 C CNN
	1    5200 5000
	1    0    0    -1  
$EndComp
Wire Wire Line
	4900 4800 5900 4800
Wire Wire Line
	5900 4800 5900 4200
Connection ~ 5900 4200
Wire Wire Line
	4900 4900 5200 4900
Wire Wire Line
	5200 4900 5200 5000
Wire Wire Line
	5000 5000 4900 5000
Wire Wire Line
	3100 4200 4100 4200
Wire Wire Line
	5000 5000 5000 5100
Wire Wire Line
	5000 5100 3900 5100
Wire Wire Line
	3900 5100 3900 4300
Wire Wire Line
	3900 4300 3100 4300
Wire Wire Line
	3100 4500 3700 4500
Wire Wire Line
	3700 4500 3700 5400
Wire Wire Line
	3700 5400 8200 5400
Text Label 8200 5000 1    50   ~ 0
DCDC_OUT
Wire Wire Line
	3100 4000 4100 4000
Wire Wire Line
	4100 4100 3100 4100
Wire Wire Line
	8200 2500 7700 2500
Connection ~ 8200 4100
Wire Wire Line
	7900 3600 7900 3700
Wire Wire Line
	8100 2400 8600 2400
Wire Wire Line
	5900 4200 6300 4200
Wire Wire Line
	8200 4100 8200 5400
$EndSCHEMATC
